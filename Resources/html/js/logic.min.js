var borderColors=["#000000","#660000","#cc3333","#663399","#0066cc","#66cccc","#669900","#666600","#cccc33","#ffcc33","#ff6600","#996633","#999999","#cccccc","#333333"],postTemplate='            <li data-icon="false">                <a href="#" class="postListItem" data-id="<%= id %>">                    <% if(text.length < 5 && iLepra.config.loadImages && image.length > 0){ %>                        <div>                            <img src="<%= image.replace("http://src.sencha.io/80/80/", "http://src.sencha.io/"+iLepra.config.screenBiggest+"/") %>" />                        </div>                    <% }else{ %>                        <% if(iLepra.config.loadImages && image.length > 0){ %>                            <img src="<%= image %>" class="postThumb" />                        <% } %>                        <h3 style="white-space:normal; font-weight:normal;"><%= text %></h3>                        <p><% if(domain_url != ""){ %><%= domain_url %> <% } %></p>                    <% } %>                </a>            </li>            <li data-role="list-divider" class="postInfo" data-user="<%= user %>">                <img />                <b><%= user %></b>,                 <span style="font-size:80%;">                <img src="./css/img/comment_16.png" class="iconImage" />                <% if(comments.indexOf("/") != -1){ %>                <b><%= comments %></b>,                <% }else{ %>                <%= comments %>,                <% } %>                <%= when %></span>                <% if(rating != undefined && rating.length > 0 && rating != 0){ %>,                     <span style="font-weight: bold; color:                     <% if( rating >= 0 ){ %>#157B25<% }else{ %>                        #824E48<% } %>                    "><%= rating %></span>                 <% } %>            </li>',subsTemplate='            <li>                <a href="#" class="subListItem" data-link="<%= link %>">                    <% if(iLepra.config.loadImages){ %><img src="<%= logo %>" class="postThumb" /><% } %>                    <h1><%= name %></h1>                    <p><%= creator %></p>                </a>            </li>',commentTemplate='            <li data-id="<%= id %>" data-user="<%= user %>" class="<%= newClass %>" <%= style %>>                <p class="commentText"><%= text %></p>                <div style="display:none;" class="commentsMenu">                    <a href="#" class="reply"><img src="./css/img/reply_32.png" /></a>                    <a href="#" class="voteup" style="float:right;                     <% if(vote == 1){ %>opacity: 1;<% }else{ %> opacity: 0.3; <% } %>                    "><img src="./css/img/voteup_32.png" /></a>                    <a href="#" class="votedown" style="float:right;                     <% if(vote == -1){ %>opacity: 1;<% }else{ %> opacity: 0.3; <% } %>                    "><img src="./css/img/votedown_32.png" /></a>                </div>            </li>            <li data-role="list-divider" class="postInfo" data-user="<%= user %>" <%= style %>>                <img />                <b><%= user %></b>,                 <%= when %></span>                <% if(rating != undefined && rating.length > 0 && rating != 0){ %>,                     <span style="font-weight: bold; color:                     <% if( rating >= 0 ){ %>#157B25<% }else{ %>                        #824E48<% } %>                    "><%= rating %></span>                 <% } %>            </li>',chatTemplate='            <li data-icon="false"  class="chatMessage commentText" data-user="<%= user_login %>">                <p class="commentText"><%= body %></p>            </li>            <li data-role="list-divider" class="postInfo">                <b><%= user_login %></b>,                 <%= createdate %></span>            </li>';window.addEventListener("load",function(){$.support.cors=!0,$.mobile.allowCrossDomainPages=!0,$.mobile.pushStateEnabled=!1,$.mobile.loadingMessageTextVisible=!0,$.mobile.loadingMessage="Загружаемся ...",$.mobile.fixedtoolbar.prototype.options.tapToggle=!1,$.mobile.defaultPageTransition="none",$.mobile.defaultDialogTransition="none"}),window.addEventListener("load",function(){var a=function(){$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.changePage("#postsPage")}),iLepra.getLastPosts(!0)};$(document).bind(iLepra.events.init,function(b){$(document).unbind(b),iLepra.isAuthenticated?a():$.mobile.changePage("#loginPage")}),$(document).on("pagebeforeshow","#loginPage",function(){Ti.App.fireEvent("iLepraChangeTitle",{title:"iLepra"}),Ti.API.log("ilepra auth: "+iLepra.isAuthenticated),$("#captchaImage").attr("src",iLepra.captchaURL),$("#loginButton").bind("tap",function(){$.mobile.showPageLoadingMsg();var b={user:$("#username").val(),pass:$("#pass").val(),captcha:$("#captcha").val().toLowerCase(),save:$("#rememberme").is(":checked")?1:0};$(document).bind(iLepra.events.error,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),iLepra.ui.showError(iLepra.errorMessage),$("#captchaImage").attr("src",iLepra.captchaURL)}),$(document).bind(iLepra.events.ready,function(b){Ti.API.log("ready"),$(document).unbind(b),$(document).unbind(iLepra.events.error),a()}),iLepra.tryLogin(b)}),Ti.App.fireEvent("iLepraInitDone")}),iLepra.init()}),function(){var a=null,b=function(){if(a!=null){updateNewsCounts();return}a=setInterval(c,12e4),c()},c=function(){$(document).bind(iLepra.events.update,function(a){$(document).unbind(a),d()}),iLepra.getNewsCounters()},d=function(){var a=$(".inboxCounter"),b=$(".mystuffCounter"),c="";iLepra.inboxNewPosts>0?c+=iLepra.inboxNewPosts+"/"+iLepra.inboxNewComments:iLepra.inboxNewComments>0?c+=iLepra.inboxNewComments:c="",c!=""?(a.text(c),a.show()):a.hide();var d="";iLepra.myNewPosts>0?d+=iLepra.myNewPosts+"/"+iLepra.myNewComments:iLepra.myNewComments>0?d+=iLepra.myNewComments:d="",d!=""?(b.text(d),b.show()):b.hide()};window.initCounters=b,window.updateNewsCounts=d}(),function(){var a=function(a){$(a).parents("li").removeClass("ui-li-has-thumb"),$(a).parent().append("&nbsp;"),$(a).remove()};window.handleImageError=a}(),function(){var a=iLepra.config.postIncrement,b=null,c=null,d=function(){var c=a>iLepra.myStuffPosts.length?iLepra.myStuffPosts.length:a,d="";for(var e=0;e<c;e++)d+=_.template(postTemplate,iLepra.myStuffPosts[e]);b.empty(),b.append(d);try{b.listview("refresh")}catch(f){}};$(document).on("pagebeforeshow","#mystuffPage",function(){Ti.App.fireEvent("iLepraChangeTitle",{title:"Мои вещи"}),b=$("#mystuffList"),c=$("#moreMystuffButton"),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b),$.mobile.hidePageLoadingMsg(),d(),a<iLepra.myStuffPosts.length&&(c.show(),c.bind("tap",function(b){b.preventDefault(),b.stopPropagation(),a+=a,a>=iLepra.myStuffPosts.length&&c.hide(),d()}))}),iLepra.getMyStuff(),updateNewsCounts()})}(),function(){var a=iLepra.config.postIncrement,b=null,c=null,d=function(){var c=a>iLepra.inboxPosts.length?iLepra.inboxPosts.length:a,d="";for(var e=0;e<c;e++)d+=_.template(postTemplate,iLepra.inboxPosts[e]);b.empty(),b.append(d);try{b.listview("refresh")}catch(f){}};$(document).on("pagebeforeshow","#inboxPage",function(){Ti.App.fireEvent("iLepraChangeTitle",{title:"Инбокс"}),b=$("#inboxList"),c=$("#moreInboxButton"),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b),$.mobile.hidePageLoadingMsg(),d(),a<iLepra.inboxPosts.length&&(c.show(),c.bind("tap",function(b){b.preventDefault(),b.stopPropagation(),a+=a,a>=iLepra.inboxPosts.length&&c.hide(),d()}))}),iLepra.getInbox(),updateNewsCounts()})}(),function(){var a=iLepra.config.postIncrement,b=null,c=null,d=function(){var c=a>iLepra.latestPosts.length?iLepra.latestPosts.length:a,d="";for(var e=0;e<c;e++)d+=_.template(postTemplate,iLepra.latestPosts[e]);b.empty(),b.append(d);try{b.listview("refresh")}catch(f){}},e=function(){$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),d()})};Ti.App.addEventListener("iLepraPostBack",function(){$.mobile.changePage("#postsPage")}),$(document).on("pagebeforehide","#postsPage",function(a){Ti.App.fireEvent("iLepraOrganize",{show:!1}),Ti.App.fireEvent("iLepraRefresh",{show:!1})}),$(document).on("pagebeforeshow","#postsPage",function(e){Ti.App.fireEvent("iLepraChangeTitle",{title:"Главная"}),Ti.App.fireEvent("iLepraOrganize",{show:!0}),Ti.App.fireEvent("iLepraRefresh",{show:!0}),b=$("#postsList"),c=$("#morePostsButton"),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),c.show(),d()}),iLepra.getLastPosts(),initCounters(),c.bind("tap",function(b){b.preventDefault(),b.stopPropagation(),a<iLepra.latestPosts.length?(a+=a,d()):($.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),d()}),iLepra.getMorePosts())}),Ti.App.fireEvent("iLepraInitDone")}),Ti.App.addEventListener("iLepraMainChange",function(a){Ti.API.log(a);switch(a.val){case"main":e(),iLepra.switchLayout(1);break;case"all":e(),iLepra.switchLayout(0);break;case"sub":e(),iLepra.switchLayout(2)}}),Ti.App.addEventListener("iLepraDoRefresh",function(a){if($.mobile.activePage.attr("id")!="postsPage")return;$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),d()}),iLepra.getLastPosts(!0)}),$(document).on("tap","a.postListItem",function(a){a.preventDefault(),a.stopImmediatePropagation(),currentPostId=$(this).data("id");if($.mobile.activePage.attr("id")=="postsPage"){for(var b in iLepra.latestPosts)if(iLepra.latestPosts[b].id==currentPostId){iLepra.post.current=iLepra.latestPosts[b];break}}else if($.mobile.activePage.attr("id")=="mystuffPage"){for(var b in iLepra.myStuffPosts)if(iLepra.myStuffPosts[b].id==currentPostId){iLepra.post.current=iLepra.myStuffPosts[b];break}}else if($.mobile.activePage.attr("id")=="inboxPage"){for(var b in iLepra.inboxPosts)if(iLepra.inboxPosts[b].id==currentPostId){iLepra.post.current=iLepra.inboxPosts[b];break}}else if($.mobile.activePage.attr("id")=="favsPage"){for(var b in iLepra.favouritePosts)if(iLepra.favouritePosts[b].id==currentPostId){iLepra.post.current=iLepra.favouritePosts[b];break}}else if($.mobile.activePage.attr("id")=="subpostsPage")for(var b in iLepra.sub.posts)if(iLepra.sub.posts[b].id==currentPostId){iLepra.post.current=iLepra.sub.posts[b];break}Ti.App.fireEvent("iLepraPostShow"),$.mobile.changePage("#fullPostPage")}),$(document).on("pagebeforeshow","#fullPostPage",function(){$("#postContent").html(iLepra.post.current.body),$("#postUser").text(iLepra.post.current.user),$("#postComments").text(iLepra.post.current.comments),$("#postTime").text(iLepra.post.current.when),$("#postRating").text(iLepra.post.current.rating)})}(),function(){var a=!1,b=iLepra.config.postIncrement,c="all",d=null,e=null,f=-1,g=null,h=null,i=null,j=null,k=null,l=function(){var a="";if(c=="all"){var d=b>iLepra.post.comments.length?iLepra.post.comments.length:b;for(var e=0;e<d;e++)a+=_.template(commentTemplate,iLepra.post.comments[e])}else if(c=="new"){var d=b>iLepra.post.newComments.length?iLepra.post.newComments.length:b;for(var e=0;e<d;e++)a+=_.template(commentTemplate,iLepra.post.newComments[e])}g.empty(),g.append(a);try{g.listview("refresh")}catch(f){}$(".new").length>0?h.show():h.hide()},m=function(){$("#moreCommentsButton").bind("tap",function(a){a.preventDefault(),a.stopPropagation(),b+=b,b>=iLepra.post.comments.length&&$("#commentsButtons").hide(),g.empty(),l(),g.listview("refresh")}),$("#allCommentsButton").bind("tap",function(a){a.preventDefault(),a.stopPropagation(),b=iLepra.post.comments.length,$("#commentsButtons").hide(),l()})};Ti.App.addEventListener("iLepraDoRefresh",function(){Ti.API.log($.mobile.activePage.attr("id"));if($.mobile.activePage.attr("id")!="fullPostPage")return;n()}),$(document).on("pagebeforeshow","#fullPostPage",function(){Ti.App.fireEvent("iLepraRefresh",{show:!0}),$("#postCommentsButtonsGroup").show(),g.empty(),h.hide(),$("#postCommentsContent").hide(),$("#replyPost").hide(),$("#commentsButtons").hide()}),$(document).on("pagecreate","#fullPostPage",function(){b=iLepra.config.postIncrement,g=$("#commentsList"),h=$("#commentsNavBar"),i=$("#commentsNavButtons"),j=$("#commentsInputBar"),k=$("#commentInput"),$("#postCommentsButton").bind("tap",n),$("#postNewCommentsButton").bind("tap",function(a){$("#allComments").removeClass("ui-btn-active"),$("#newComments").addClass("ui-btn-active"),c="new",n(a)}),$("#allComments").bind("tap",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).addClass("ui-btn-active"),$("#newComments").removeClass("ui-btn-active"),c="all",l()}),$("#newComments").bind("tap",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).addClass("ui-btn-active"),$("#allComments").removeClass("ui-btn-active"),c="new",l()}),$("#replyPost").bind("tap",function(a){a.preventDefault(),a.stopImmediatePropagation(),d=null,e=null,o()}),$("#prevnew").bind("tap",function(a){a.preventDefault(),a.stopImmediatePropagation(),--f&&(f=0);var b=$($("ul#commentsList li.new")[f]);b!=null&&$.mobile.silentScroll(b.offset().top)}),$("#nextnew").bind("tap",function(a){a.preventDefault(),a.stopImmediatePropagation();var b=$("ul#commentsList li.new");++f>b.length-1&&(f=b.length-1);var c=$(b[f]);c!=null&&$.mobile.silentScroll(c.offset().top)}),$("#postVoteup").bind("tap",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).css("opacity",1),$(this).next().css("opacity",.6),iLepra.post.votePost("p"+iLepra.post.current.id,"1")}),$("#postVotedown").bind("tap",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).prev().css("opacity",.6),$(this).css("opacity",1),iLepra.post.votePost("p"+iLepra.post.current.id,"-1")}),$("#submitComment").bind("tap",function(a){a.preventDefault(),a.stopImmediatePropagation();var b=k.val();$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.error,function(a){$(document).unbind(a),$(document).unbind(iLepra.events.ready),$.mobile.hidePageLoadingMsg(),iLepra.ui.showError("Ошибка добавлени комментария! Попробуйте еще раз?")}),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$(document).unbind(iLepra.events.error),$.mobile.hidePageLoadingMsg(),k.val(""),i.show(),j.hide(),l()}),iLepra.post.addComment(b,d)}),iLepra.post.current.vote==1?$("#postVoteup").css("opacity",1):iLepra.post.current.vote==-1&&$("#postVotedown").css("opacity",1)}),$(document).on("tap","div.commentsMenu a.reply",function(a){a.preventDefault(),a.stopImmediatePropagation(),o()}),$(document).on("tap","div.commentsMenu a.voteup",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).css("opacity",1),$(this).next().css("opacity",.3),iLepra.post.voteComment(d,"1")}),$(document).on("tap","div.commentsMenu a.votedown",function(a){a.preventDefault(),a.stopImmediatePropagation(),$(this).prev().css("opacity",.3),$(this).css("opacity",1),iLepra.post.voteComment(d,"-1")}),$(document).on("tap","#commentsList li",function(a){a.preventDefault(),a.stopImmediatePropagation(),d=$(this).data("id"),e=$(this).data("user"),$(".commentsMenu").hide();var b=$("div.commentsMenu",this);b.show();var c=$(b.find("a")[1]);iLepra.post.current.type=="inbox"&&c.is(":visible")?c.hide().next().hide():c.is(":visible")||c.show().next().show()});var n=function(c){if(c)try{c.preventDefault(),c.stopImmediatePropagation()}catch(d){}if(a)return;$.mobile.showPageLoadingMsg(),a=!0,$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c),$.mobile.hidePageLoadingMsg(),$("#postCommentsButtonsGroup").hide(),$("#postCommentsContent").show(),$("#replyPost").show(),l(),b>=iLepra.post.comments.length?$("#commentsButtons").hide():m(),a=!1}),iLepra.post.getComments()},o=function(){h.show(),i.hide(),j.show(),e!=null?k.val(e+": "):k.val("")}}(),function(){Ti.App.addEventListener("iLepraMenuSelect",function a(a){Ti.App.fireEvent("iLepraToggleMenu"),Ti.API.log(a);switch(a.entry){case"posts":setTimeout(function(){$.mobile.changePage("#postsPage")},520);break;case"mystuff":setTimeout(function(){$.mobile.changePage("#mystuffPage")},520);break;case"inbox":setTimeout(function(){$.mobile.changePage("#inboxPage")},520);break;case"favs":setTimeout(function(){$.mobile.changePage("#favsPage")},520);break;case"mysubs":setTimeout(function(){iLepra.sub.list=iLepra.userSubLepras,iLepra.sub.fetch=!1,$.mobile.changePage("#subsPage")},520);break;case"subs":setTimeout(function(){iLepra.sub.fetch=!0,$.mobile.changePage("#subsPage")},520);break;case"gov":setTimeout(function(){$.mobile.changePage("#govPage")},520);break;case"chat":setTimeout(function(){$.mobile.changePage("#chatPage")},520);break;case"exit":setTimeout(function(){$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$(document).bind(iLepra.events.init,function(a){$(document).unbind(a),$.mobile.changePage("#loginPage")}),iLepra.init()}),iLepra.doLogout()},520);break;case"profile":}})}(),function(){var a=iLepra.config.postIncrement,b=null,c=null,d=function(){var c="",d=a>iLepra.favouritePosts.length?iLepra.favouritePosts.length:a;for(var e=0;e<d;e++)c+=_.template(postTemplate,iLepra.favouritePosts[e]);b.empty(),b.append(c);try{b.listview("refresh")}catch(f){}};$(document).on("pagebeforeshow","#favsPage",function(){Ti.App.fireEvent("iLepraChangeTitle",{title:"Избранное"}),b=$("#favsList"),c=$("#moreFavsButton"),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(b){$(document).unbind(b),$.mobile.hidePageLoadingMsg(),d(),a<iLepra.favouritePosts.length&&(c.show(),c.bind("tap",function(b){b.preventDefault(),b.stopPropagation(),a+=a,a>=iLepra.favouritePosts.length&&c.hide(),d()}))}),iLepra.getFavourites()})}();var profileName;(function(){$(document).on("tap","ul li.postInfo",function(a){a.preventDefault(),a.stopImmediatePropagation(),profileName=$(this).data("user"),$.mobile.changePage("more_profile.html")}),$(document).on("pagebeforeshow","#profilePage",function(){Ti.App.fireEvent("iLepraChangeTitle",{title:"Профиль"}),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),$("#profileContent").show();var b=iLepra.profile.data;$("#profileUsername").text(b.username),b.userpic!=undefined&&$("#userImage").attr("src",b.userpic),$("#fullName").text(b.fullName),$("#userLocation").text(b.location),$("#userRegdate").html(b.regDate),$("#userNumber").text("Номер; "+b.number),$("#userKarma").text("Карма: "+b.karma),$("#userStat").text(b.userstat);var c=b.votestat.split("<br>");$("#userVote").html(c[0]),$("#userVoteCount").html(c[1]),$("#userDescription").html(b.description);var d=$("#contactsList"),e,f,g;for(e=0;e<b.contacts.length;e++)g=/href="(.+?)"/g.exec(b.contacts[e]),f=b.contacts[e].replace(/\s\s+/g," ").replace(/[\n\r]/g,"").replace(/<.+?>/g,""),f.length>1&&(g!=null?d.append($('<li><a href="'+g[1]+'">'+f+"</a></li>")):d.append($("<li>"+f+"</li>")));d.listview("refresh")}),iLepra.profile.getProfile(profileName)})})(),$(window).load(function(){var a=null,b=null,c=iLepra.config.postIncrement,d=null,e=null,f=null,g=function(){var a="";for(var b=0;b<iLepra.sub.list.length;b++)a+=_.template(subsTemplate,iLepra.sub.list[b]);d.append(a);try{d.listview("refresh")}catch(c){}};$(document).on("pagebeforeshow","#subsPage",function(){Ti.App.fireEvent("iLepraChangeTitle",{title:"Подлерпы"}),d=$("#subsList"),d.empty(),iLepra.sub.fetch?($.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),g()}),iLepra.sub.getList()):g()}),$(document).on("tap","a.subListItem",function(c){c.preventDefault(),c.stopImmediatePropagation(),a=$(this).children("h1").text(),b=$(this).data("link"),$.mobile.changePage("more_subposts.html")});var h=function(){var a=c>iLepra.sub.posts.length?iLepra.sub.posts.length:c,b="";for(var d=0;d<a;d++)b+=_.template(postTemplate,iLepra.sub.posts[d]);e.empty(),e.append(b);try{e.listview("refresh")}catch(f){}};$(document).on("pagebeforeshow","#subpostsPage",function(){e=$("#subpostsList"),f=$("#moreSubpostsButton"),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),f.show(),h()}),iLepra.sub.getPosts(b),$("#subpostsTitle").text(a),f.bind("tap",function(a){a.preventDefault(),a.stopPropagation(),c<iLepra.sub.posts.length?(c+=c,h()):($.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),h()}),iLepra.sub.getMorePosts(b))})})}),function(){$(document).on("pagebeforeshow","#govPage",function(){Ti.App.fireEvent("iLepraChangeTitle",{title:"Белый дом"}),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(a){$(document).unbind(a),$.mobile.hidePageLoadingMsg(),$("#president").html("<a href='#' class='username'>"+iLepra.gov.president+"</a> - "+iLepra.gov.time)}),iLepra.gov.getCurrent()})}(),function(){var a=null,b=null,c=null,d=null,e=64,f=function(){c.empty();var b="",d,f=a.length>e?e:a.length;for(d=0;d<f;d++)b+=_.template(chatTemplate,a[d]);c.append(b),c.listview("refresh")},g=function(b){$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c),a=iLepra.chat.messages.slice(0),a.sort(function(a,b){return a.id>b.id?-1:1}),f(),typeof b!="undefined"&&b&&$.mobile.hidePageLoadingMsg()}),iLepra.chat.getMessages()};$(document).on("pagebeforehide","#chatPage",function(){Ti.App.fireEvent("iLepraChatBar",{show:!1})}),$(document).on("pagebeforeshow","#chatPage",function(){Ti.App.fireEvent("iLepraChangeTitle",{title:"Лепрочятик"}),Ti.App.fireEvent("iLepraChatBar",{show:!0}),c=$("#chatList"),d=$("#chatInput"),$("#submitChat").bind("tap",function(c){c.preventDefault(),c.stopImmediatePropagation();var e=d.val();d.val(""),clearInterval(b),$.mobile.showPageLoadingMsg(),$(document).bind(iLepra.events.ready,function(c){$(document).unbind(c),$.mobile.hidePageLoadingMsg(),a=iLepra.chat.messages.slice(0),a.sort(function(a,b){return a.id>b.id?-1:1}),f(),b=setInterval("requestNewChatData()",1e4)}),iLepra.chat.sendMessage(e)}),$.mobile.showPageLoadingMsg(),g(!0),b=setInterval("requestNewChatData()",1e4)}),$(document).on("pagehide","#chatPage",function(){clearInterval(b)}),$(document).on("tap","li.chatMessage",function(a){a.preventDefault(),a.stopImmediatePropagation();var b=$(this).data("user");d.val(b+": ")})}();